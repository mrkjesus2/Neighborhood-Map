app.map=app.map||{},function(){app.map={init:function(){var e={lat:39.927677,lng:-75.171909},a=document.getElementById("map-container");this.map=new google.maps.Map(a,{center:e,zoom:14,minZoom:12,maxZoom:18,mapTypeControl:!1}),this.placesApi=new google.maps.places.PlacesService(app.map.map),this.infoWindow=new google.maps.InfoWindow({maxWidth:.7*$(window).width()}),google.maps.event.addListener(this.infoWindow,"closeclick",app.viewmodel.showDrawerBtn),setTimeout(function(){console.log("Setting error message"),app.viewmodel.mapError("There appears to be a problem with Google Maps, please try refreshing the page")},5e3),google.maps.event.addListenerOnce(this.map,"bounds_changed",this.getPlaces)},createPlaces:function(e){e.forEach(function(e,a){var o=new app.viewmodel.Place(e);app.viewmodel.places.push(o),1===a&&app.viewmodel.curPlace(o)})},storePlaces:function(e){localStorage.setItem("places",JSON.stringify(e))},retrievePlaces:function(){var e=JSON.parse(localStorage.places);return e.forEach(function(e){var a=e.geometry.location.lat,o=e.geometry.location.lng;e.geometry.location.lat=function(){return a},e.geometry.location.lng=function(){return o}}),e},getPlaces:function(){if(localStorage.places&&app.map.sameBoundsCheck())console.log("Creating places from storage"),app.map.createPlaces(app.map.retrievePlaces()),ko.applyBindings(app.viewmodel);else{localStorage.setItem("bounds",JSON.stringify(app.map.map.getBounds()));var e={bounds:app.map.map.getBounds(),types:["art_gallery","museum","park"]};app.map.placesApi.nearbySearch(e,function(e,a){if(console.log("Calling Places API"),"OK"===a)app.map.setPhotoUrls(e),app.map.storePlaces(e),app.map.createPlaces(e);else{console.log("We have a places error");var o="Google Places Error: "+a;app.viewmodel.addError(o)}ko.applyBindings(app.viewmodel)})}},sameBoundsCheck:function(){var e=JSON.parse(localStorage.bounds);return app.map.map.getBounds().equals(e)},setPhotoUrls:function(e){e.forEach(function(e){if(e.photos){var a=e.photos[0].getUrl({maxWidth:200,maxHeight:300});e.photos[0].url=a}})},getPlaceDetails:function(e){var a={placeId:e.data.place_id};app.map.placesApi.getDetails(a,function(a,o){if(console.log("status",o),"OK"===o){var t=new app.viewmodel.PlaceDetails(a);e.details(t)}else{var p="Google Places Error while getting details: "+o;app.viewmodel.addError(p)}})},createMarker:function(e){var a=e.data.geometry.location,o={url:e.data.icon,scaledSize:new google.maps.Size(50,50)},t=new google.maps.Marker({animation:google.maps.Animation.DROP,attribution:{source:"mrkjesus2.github.io/Neighborhood-Map"},icon:o,map:app.map.map,place:{location:{lat:a.lat(),lng:a.lng()},placeId:e.data.place_id},title:e.data.name});return google.maps.event.addListener(t,"click",function(){app.viewmodel.clickHandler(e)}),t}}}();
//# sourceMappingURL=main.min.js.map
