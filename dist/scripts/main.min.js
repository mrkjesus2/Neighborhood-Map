/*!
 *
 *  Web Starter Kit
 *  Copyright 2015 Google Inc. All rights reserved.
 *
 *  Licensed under the Apache License, Version 2.0 (the "License");
 *  you may not use this file except in compliance with the License.
 *  You may obtain a copy of the License at
 *
 *    https://www.apache.org/licenses/LICENSE-2.0
 *
 *  Unless required by applicable law or agreed to in writing, software
 *  distributed under the License is distributed on an "AS IS" BASIS,
 *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *  See the License for the specific language governing permissions and
 *  limitations under the License
 *
 */
!function(){"use strict";var e=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));"serviceWorker"in navigator&&("https:"===window.location.protocol||e)&&navigator.serviceWorker.register("service-worker.js").then(function(e){"function"==typeof e.update&&e.update(),e.onupdatefound=function(){if(navigator.serviceWorker.controller){var a=e.installing;a.onstatechange=function(){switch(a.state){case"installed":break;case"redundant":throw new Error("The installing service worker became redundant.")}}}}})["catch"](function(e){console.error("Error during service worker registration:",e)})}();var app=app||{};app.map=app.map||{},function(){app.map={init:function(){var e={lat:39.927677,lng:-75.171909},a=document.getElementById("map-container");this.map=new google.maps.Map(a,{center:e,zoom:14,minZoom:12,maxZoom:18,mapTypeControl:!1}),this.placesApi=new google.maps.places.PlacesService(app.map.map),this.infoWindow=new google.maps.InfoWindow({maxWidth:.7*$(window).width()}),google.maps.event.addListener(this.infoWindow,"closeclick",function(){$("#drawer-btn").removeClass("open"),$("#drawer-btn").addClass("closed")}),setTimeout(function(){$("#maps-error").css("display","inline")},5e3),google.maps.event.addListenerOnce(this.map,"bounds_changed",this.getPlaces)},createPlaces:function(e){e.forEach(function(e,a){var o=new app.viewmodel.Place(e);app.viewmodel.places.push(o),1===a&&(console.log("set current place"),app.viewmodel.curPlace(o))})},storePlaces:function(e){localStorage.setItem("places",JSON.stringify(e))},retrievePlaces:function(){var e=JSON.parse(localStorage.places);return e.forEach(function(e){var a=e.geometry.location.lat,o=e.geometry.location.lng;e.geometry.location.lat=function(){return a},e.geometry.location.lng=function(){return o}}),e},getPlaces:function(){if(localStorage.places)console.log("Creating places from storage"),app.map.createPlaces(app.map.retrievePlaces()),ko.applyBindings(app.viewmodel);else{var e={bounds:app.map.map.getBounds(),types:["art_gallery","museum","park"]};app.map.placesApi.nearbySearch(e,function(e,a){if(console.log("Calling Places API"),"OK"===a)app.map.setPhotoUrls(e),app.map.storePlaces(e),app.map.createPlaces(e);else{console.log("We have a places error");var o="Google Places Error: "+a;app.viewmodel.addError(o)}ko.applyBindings(app.viewmodel)})}},setPhotoUrls:function(e){e.forEach(function(e){if(e.photos){var a=e.photos[0].getUrl({maxWidth:200,maxHeight:200});console.log(typeof a),e.photos[0].url=a}})},getPlaceDetails:function(e){var a={placeId:e.data.place_id};app.map.placesApi.getDetails(a,function(a,o){if(console.log("status",o),"OK"===o){var t=new app.viewmodel.PlaceDetails(a);e.details(t)}else{var r="Google Places Error while getting details: "+o;app.viewmodel.addError(r)}})},createMarker:function(e){var a=e.data.geometry.location,o=new google.maps.Marker({animation:google.maps.Animation.DROP,attribution:{source:"mrkjesus2.github.io/Neighborhood-Map"},icon:e.data.icon,map:app.map.map,place:{location:{lat:a.lat(),lng:a.lng()},placeId:e.data.place_id},title:e.data.name});return google.maps.event.addListener(o,"click",function(){app.viewmodel.clickHandler(e)}),o}}}(),app.foursquare=app.foursquare||{},function(){var e="ZBGAM3NOJCK4P345ELK2JIB232FMDENJ05GXYQRSAHOHURJR",a="RGEF2DNONIR0AN2GHSIIMGZWLT0IH5JSJCJ5AGFAJ2WZDGLH";app.foursquare={baseUrl:"https://api.foursquare.com/v2/venues/",version:"20140806",findPlace:function(o){var t=o.data.geometry.location;jQuery.ajax({url:this.baseUrl+"search",data:{query:o.name(),ll:t.lat()+","+t.lng(),client_id:e,client_secret:a,v:this.version,limit:"1"},dataType:"json"}).done(function(e){var a=e.response.venues[0];app.foursquare.getTips(a,o)}).fail(function(e){var a="Foursquare Error: "+e.statusText;app.viewmodel.addError(a)})},getTips:function(o,t){jQuery.ajax({url:this.baseUrl+o.id+"/tips",data:{client_id:e,client_secret:a,v:this.version},dataType:"json"}).done(function(e){var a=e.response.tips;app.viewmodel.fourSquare(o,a,t)}).fail(function(e){var a="Foursquare Tips Error: "+e.statusText;app.viewmodel.addError(a)})}}}(),app.wiki=app.wiki||{},function(){app.wiki={getWiki:function(e){jQuery.ajax({url:"https://en.wikipedia.org/w/api.php",data:{action:"query",prop:"categories|extracts|info",exintro:"",exchars:1e3,inprop:"url",format:"json",redirects:"",converttitles:"",titles:e.name()},dataType:"jsonp",headers:{"Api-User-Agent":"Mark's Udacity Project"}}).done(function(a){var o=Object.keys(a.query.pages)[0],t=new app.viewmodel.WikiPage(a.query.pages[o]);void 0===t.content()||app.wiki.ambiguityChk(a,o)||e.wikiInfo(t)}).fail(function(e){var a="Wikipedia Error: "+e.statusText;app.viewmodel.addError(a)})},ambiguityChk:function(e,a){var o=e.query.pages[a].categories;for(var t in o)return"Category:All article disambiguation pages"===o[t].title?!0:!1}}}(),app.viewmodel=app.viewmodel||{},app.viewmodel={places:ko.observableArray(),curMarker:null,curPlace:ko.observable(),inputText:ko.observable(""),frsqr:null,errorMsg:ko.observableArray([]),Place:function(e){this.show=ko.observable(!0),this.name=ko.observable(e.name),this.rating=ko.observable(e.rating),this.open=ko.observable(e.opening_hours?"Open Now":"Closed"),e.photos?this.photo=ko.observable({url:ko.observable(e.photos[0].url),height:ko.observable(e.photos[0].height),width:ko.observable(e.photos[0].width),attributions:ko.observable(e.photos[0].html_attributions)}||{}):this.photo=ko.observable("none"),this.data=e,this.detailsIcon=ko.observable("fa fa-chevron-circle-up"),this.details=ko.observable(),this.marker=app.map.createMarker(this),this.wikiInfo=ko.observable(),this.frSqrInfo=ko.observable()},WikiPage:function(e){this.content=ko.observable(e.extract),this.url=ko.observable(e.fullurl)},fourSquare:function(e,a,o){var t=ko.mapping.fromJS(e,{}),r=ko.mapping.fromJS(a,{});t.tips=r,o.frSqrInfo(t)},PlaceDetails:function(e){this.show=ko.observable(!0),this.address=ko.observable(e.formatted_address),this.phone=ko.observable(e.formatted_phone_number),this.photos=ko.observableArray(e.photos),this.rating=ko.observable(e.rating),this.website=ko.observable(e.website),this.reviews=ko.observableArray(new app.viewmodel.Reviews(e.reviews))},Reviews:function(e){var a=[];return e.forEach(function(e){a.push({author:ko.observable(e.author_name),authorUrl:ko.observable(e.author_url),text:ko.observable(e.text),time:ko.observable(e.time)})}),a},addError:function(e){this.errorMsg=this.errorMsg||ko.observableArray([]),this.errorMsg.push(e),setTimeout(function(){app.viewmodel.clearErrors()},2e3)},clearErrors:function(){this.errorMsg([])},setCurrentPlace:function(e){app.viewmodel.curPlace().marker.getAnimation()&&app.viewmodel.toggleBounce(),app.viewmodel.curPlace(e)},toggleDetails:function(e){void 0!==e.details()&&e.details().show()===!0?(e.details().show(!1),e.detailsIcon("fa fa-chevron-circle-up")):(app.map.getPlaceDetails(e),app.viewmodel.setCurrentPlace(e),e.detailsIcon("fa fa-chevron-circle-down"))},clickContactInfo:function(){this.inputText(this.curPlace().name()),$("#drawer-top input").trigger("input"),this.toggleDetails(app.viewmodel.curPlace()),app.map.infoWindow.close(),this.closeDrawer(),this.toggleDrawer()},clickHandler:function(e){var a=e||this;app.wiki.getWiki(a),app.foursquare.findPlace(a),app.map.infoWindow.close(),app.viewmodel.closeDrawer(),app.viewmodel.setCurrentPlace(a),app.viewmodel.toggleBounce(),setTimeout(function(){app.viewmodel.setInfoWindow(a),$("#drawer-btn").removeClass("closed"),$("#drawer-btn").addClass("open")},300)},placeFilter:function(){var e=this;return setTimeout(function(){if(e.inputText()){var a=e.places().filter(function(a){var o=a.name().toLowerCase(),t=e.inputText().toLowerCase();return 0===o.indexOf(t)});e.places().forEach(function(e){e.marker.setMap(null),e.show(!1)}),a.forEach(function(e){e.marker.setMap(app.map.map),e.show(!0)})}else e.places().forEach(function(e){e.marker.setMap(app.map.map),e.show(!0)})},100),!0},resetFilter:function(){app.viewmodel.inputText(""),$("#drawer-top input").trigger("input")},toggleBounce:function(){if(app.viewmodel.curPlace().marker.getAnimation())app.viewmodel.curPlace().marker.setAnimation(null);else{var e=app.viewmodel.curPlace().marker;e.setAnimation(google.maps.Animation.BOUNCE)}},setInfoWindow:function(e){var a=$("#infowindow").html();app.map.infoWindow.setContent(a),app.map.infoWindow.open(app.map.map,e.marker)},toggleDrawer:function(){var e=document.getElementsByClassName("drawer");$(e).toggleClass("closed open")},closeDrawer:function(){var e=$("#drawer-btn");e.hasClass("open")&&(e.removeClass("open"),e.addClass("closed")),$("#drawer-content").hasClass("open")&&app.viewmodel.toggleDrawer()},openModal:function(){$("#modal").css("display","initial"),console.log("Open Modal")},closeModal:function(){$("#modal").css("display","none")},init:function(){var e=document.getElementById("drawer-btn");e.addEventListener("click",app.viewmodel.toggleDrawer)}},app.viewmodel.init();
//# sourceMappingURL=main.min.js.map
