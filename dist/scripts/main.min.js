app.map=app.map||{},function(){app.map={init:function(){var e={lat:39.927677,lng:-75.171909},o=document.getElementById("map-container");this.map=new google.maps.Map(o,{center:e,zoom:14,minZoom:12,maxZoom:18,mapTypeControl:!1}),this.placesApi=new google.maps.places.PlacesService(app.map.map),this.infoWindow=new google.maps.InfoWindow({maxWidth:.7*$(window).width()}),google.maps.event.addListener(this.infoWindow,"closeclick",function(){$("#drawer-btn").removeClass("open"),$("#drawer-btn").addClass("closed")}),setTimeout(function(){$("#maps-error").css("display","inline")},5e3),google.maps.event.addListenerOnce(this.map,"bounds_changed",this.getPlaces)},createPlaces:function(e){e.forEach(function(e,o){var a=new app.viewmodel.Place(e);app.viewmodel.places.push(a),1===o&&(console.log("set current place"),app.viewmodel.curPlace(a))})},storePlaces:function(e){localStorage.setItem("places",JSON.stringify(e))},retrievePlaces:function(){var e=JSON.parse(localStorage.places);return e.forEach(function(e){var o=e.geometry.location.lat,a=e.geometry.location.lng;e.geometry.location.lat=function(){return o},e.geometry.location.lng=function(){return a}}),e},getPlaces:function(){if(localStorage.places)console.log("Creating places from storage"),app.map.createPlaces(app.map.retrievePlaces()),ko.applyBindings(app.viewmodel);else{var e={bounds:app.map.map.getBounds(),types:["art_gallery","museum","park"]};app.map.placesApi.nearbySearch(e,function(e,o){if(console.log("Calling Places API"),"OK"===o)app.map.setPhotoUrls(e),app.map.storePlaces(e),app.map.createPlaces(e);else{console.log("We have a places error");var a="Google Places Error: "+o;app.viewmodel.addError(a)}ko.applyBindings(app.viewmodel)})}},setPhotoUrls:function(e){e.forEach(function(e){if(e.photos){var o=e.photos[0].getUrl({maxWidth:200,maxHeight:200});console.log(typeof o),e.photos[0].url=o}})},getPlaceDetails:function(e){var o={placeId:e.data.place_id};app.map.placesApi.getDetails(o,function(o,a){if(console.log("status",a),"OK"===a){var t=new app.viewmodel.PlaceDetails(o);e.details(t)}else{var r="Google Places Error while getting details: "+a;app.viewmodel.addError(r)}})},createMarker:function(e){var o=e.data.geometry.location,a=new google.maps.Marker({animation:google.maps.Animation.DROP,attribution:{source:"mrkjesus2.github.io/Neighborhood-Map"},icon:e.data.icon,map:app.map.map,place:{location:{lat:o.lat(),lng:o.lng()},placeId:e.data.place_id},title:e.data.name});return google.maps.event.addListener(a,"click",function(){app.viewmodel.clickHandler(e)}),a}}}(),app.viewmodel=app.viewmodel||{},app.viewmodel={places:ko.observableArray(),curMarker:null,curPlace:ko.observable(),inputText:ko.observable(""),frsqr:null,errorMsg:ko.observableArray([]),Place:function(e){this.show=ko.observable(!0),this.name=ko.observable(e.name),this.rating=ko.observable(e.rating),this.open=ko.observable(e.opening_hours?"Open Now":"Closed"),e.photos?this.photo=ko.observable({url:ko.observable(e.photos[0].url),height:ko.observable(e.photos[0].height),width:ko.observable(e.photos[0].width),attributions:ko.observable(e.photos[0].html_attributions)}||{}):this.photo=ko.observable("none"),this.data=e,this.detailsIcon=ko.observable("fa fa-chevron-circle-up"),this.details=ko.observable(),this.marker=app.map.createMarker(this),this.wikiInfo=ko.observable(),this.frSqrInfo=ko.observable()},WikiPage:function(e){this.content=ko.observable(e.extract),this.url=ko.observable(e.fullurl)},fourSquare:function(e,o,a){var t=ko.mapping.fromJS(e,{}),r=ko.mapping.fromJS(o,{});t.tips=r,a.frSqrInfo(t)},PlaceDetails:function(e){this.show=ko.observable(!0),this.address=ko.observable(e.formatted_address),this.phone=ko.observable(e.formatted_phone_number),this.photos=ko.observableArray(e.photos),this.rating=ko.observable(e.rating),this.website=ko.observable(e.website),this.reviews=ko.observableArray(new app.viewmodel.Reviews(e.reviews))},Reviews:function(e){var o=[];return e.forEach(function(e){o.push({author:ko.observable(e.author_name),authorUrl:ko.observable(e.author_url),text:ko.observable(e.text),time:ko.observable(e.time)})}),o},addError:function(e){this.errorMsg=this.errorMsg||ko.observableArray([]),this.errorMsg.push(e),setTimeout(function(){app.viewmodel.clearErrors()},2e3)},clearErrors:function(){this.errorMsg([])},setCurrentPlace:function(e){app.viewmodel.curPlace().marker.getAnimation()&&app.viewmodel.toggleBounce(),app.viewmodel.curPlace(e)},toggleDetails:function(e){void 0!==e.details()&&e.details().show()===!0?(e.details().show(!1),e.detailsIcon("fa fa-chevron-circle-up")):(app.map.getPlaceDetails(e),app.viewmodel.setCurrentPlace(e),e.detailsIcon("fa fa-chevron-circle-down"))},clickContactInfo:function(){this.inputText(this.curPlace().name()),$("#drawer-top input").trigger("input"),this.toggleDetails(app.viewmodel.curPlace()),app.map.infoWindow.close(),this.closeDrawer(),this.toggleDrawer()},clickHandler:function(e){var o=e||this;app.wiki.getWiki(o),app.foursquare.findPlace(o),app.map.infoWindow.close(),app.viewmodel.closeDrawer(),app.viewmodel.setCurrentPlace(o),app.viewmodel.toggleBounce(),setTimeout(function(){app.viewmodel.setInfoWindow(o),$("#drawer-btn").removeClass("closed"),$("#drawer-btn").addClass("open")},300)},placeFilter:function(){var e=this;return setTimeout(function(){if(e.inputText()){var o=e.places().filter(function(o){var a=o.name().toLowerCase(),t=e.inputText().toLowerCase();return 0===a.indexOf(t)});e.places().forEach(function(e){e.marker.setMap(null),e.show(!1)}),o.forEach(function(e){e.marker.setMap(app.map.map),e.show(!0)})}else e.places().forEach(function(e){e.marker.setMap(app.map.map),e.show(!0)})},100),!0},resetFilter:function(){app.viewmodel.inputText(""),$("#drawer-top input").trigger("input")},toggleBounce:function(){if(app.viewmodel.curPlace().marker.getAnimation())app.viewmodel.curPlace().marker.setAnimation(null);else{var e=app.viewmodel.curPlace().marker;e.setAnimation(google.maps.Animation.BOUNCE)}},setInfoWindow:function(e){var o=$("#infowindow").html();app.map.infoWindow.setContent(o),app.map.infoWindow.open(app.map.map,e.marker)},toggleDrawer:function(){var e=document.getElementsByClassName("drawer");$(e).toggleClass("closed open")},closeDrawer:function(){var e=$("#drawer-btn");e.hasClass("open")&&(e.removeClass("open"),e.addClass("closed")),$("#drawer-content").hasClass("open")&&app.viewmodel.toggleDrawer()},openModal:function(){$("#modal").css("display","initial"),console.log("Open Modal")},closeModal:function(){$("#modal").css("display","none")},init:function(){var e=document.getElementById("drawer-btn");e.addEventListener("click",app.viewmodel.toggleDrawer)}},app.viewmodel.init();
//# sourceMappingURL=main.min.js.map
