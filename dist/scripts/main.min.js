app.map=app.map||{},function(){app.map={init:function(){var e={lat:39.927677,lng:-75.171909},a=document.getElementById("map-container");this.map=new google.maps.Map(a,{center:e,zoom:14,minZoom:12,maxZoom:18,mapTypeControl:!1}),this.placesApi=new google.maps.places.PlacesService(app.map.map),this.infoWindow=new google.maps.InfoWindow({maxWidth:.7*$(window).width()}),google.maps.event.addListener(this.infoWindow,"closeclick",function(){app.viewmodel.infoWindow(!1)}),setTimeout(function(){app.viewmodel.mapError("There appears to be a problem with Google Maps, please try refreshing the page")},5e3),google.maps.event.addListenerOnce(this.map,"bounds_changed",this.getPlaces)},createPlaces:function(e){e.forEach(function(e,a){var o=new app.viewmodel.Place(e);app.viewmodel.places.push(o),app.viewmodel.placeList.push(o.name()),1===a&&app.viewmodel.curPlace(o)}),app.viewmodel.autocomplete()},storePlaces:function(e){localStorage.setItem("places",JSON.stringify(e))},retrievePlaces:function(){var e=JSON.parse(localStorage.places);return e.forEach(function(e){var a=e.geometry.location.lat,o=e.geometry.location.lng;e.geometry.location.lat=function(){return a},e.geometry.location.lng=function(){return o}}),e},getPlaces:function(){if(localStorage.places&&app.map.sameBoundsCheck())console.log("Creating places from storage"),app.map.createPlaces(app.map.retrievePlaces()),ko.applyBindings(app.viewmodel);else{localStorage.setItem("bounds",JSON.stringify(app.map.map.getBounds()));var e={bounds:app.map.map.getBounds(),types:["art_gallery","museum","park"]};app.map.placesApi.nearbySearch(e,function(e,a){if(console.log("Calling Places API"),"OK"===a)app.map.setPhotoUrls(e),app.map.storePlaces(e),app.map.createPlaces(e);else{console.log("We have a places error");var o="Google Places Error: "+a;app.viewmodel.addError(o)}ko.applyBindings(app.viewmodel)})}},sameBoundsCheck:function(){if(localStorage.bounds){var e=JSON.parse(localStorage.bounds);return app.map.map.getBounds().equals(e)}return!1},setPhotoUrls:function(e){e.forEach(function(e){if(e.photos){var a=e.photos[0].getUrl({maxWidth:200,maxHeight:300});e.photos[0].url=a}})},getPlaceDetails:function(e){var a={placeId:e.data.place_id};app.map.placesApi.getDetails(a,function(a,o){if("OK"===o){var t=new app.viewmodel.PlaceDetails(a);e.details(t)}else{var r="Google Places Error while getting details: "+o;app.viewmodel.addError(r)}})},createMarker:function(e){var a=e.data.geometry.location,o={url:e.data.icon,scaledSize:new google.maps.Size(50,50)},t=new google.maps.Marker({animation:google.maps.Animation.DROP,attribution:{source:"mrkjesus2.github.io/Neighborhood-Map"},icon:o,map:app.map.map,place:{location:{lat:a.lat(),lng:a.lng()},placeId:e.data.place_id},title:e.data.name});return google.maps.event.addListener(t,"click",function(){app.viewmodel.clickHandler(e)}),t}}}(),app.foursquare=app.foursquare||{},function(){var e="ZBGAM3NOJCK4P345ELK2JIB232FMDENJ05GXYQRSAHOHURJR",a="RGEF2DNONIR0AN2GHSIIMGZWLT0IH5JSJCJ5AGFAJ2WZDGLH";app.foursquare={baseUrl:"https://api.foursquare.com/v2/venues/",version:"20140806",findPlace:function(o){var t=o.data.geometry.location;jQuery.ajax({url:this.baseUrl+"search",data:{query:o.name(),ll:t.lat()+","+t.lng(),client_id:e,client_secret:a,v:this.version,limit:"1"},dataType:"json"}).done(function(e){var a=e.response.venues[0];app.foursquare.getTips(a,o)}).fail(function(e){var a="Foursquare Error: "+e.statusText;app.viewmodel.addError(a)})},getTips:function(o,t){jQuery.ajax({url:this.baseUrl+o.id+"/tips",data:{client_id:e,client_secret:a,v:this.version},dataType:"json"}).done(function(e){var a=e.response.tips;app.viewmodel.fourSquare(o,a,t),app.viewmodel.setInfoWindow(t)}).fail(function(e){var a="Foursquare Tips Error: "+e.statusText;app.viewmodel.addError(a)})}}}(),app.wiki=app.wiki||{},function(){app.wiki={getWiki:function(e){jQuery.ajax({url:"https://en.wikipedia.org/w/api.php",data:{action:"query",prop:"categories|extracts|info",exintro:"",exchars:1e3,inprop:"url",format:"json",redirects:"",converttitles:"",titles:e.name()},dataType:"jsonp",headers:{"Api-User-Agent":"Mark's Udacity Project"}}).done(function(a){var o=Object.keys(a.query.pages)[0],t=new app.viewmodel.WikiPage(a.query.pages[o]);void 0===t.content()||app.wiki.ambiguityChk(a,o)||(e.wikiInfo(t),app.viewmodel.setInfoWindow(e))}).fail(function(e){var a="Wikipedia Error: "+e.statusText;app.viewmodel.addError(a)})},ambiguityChk:function(e,a){var o=e.query.pages[a].categories;for(var t in o)return"Category:All article disambiguation pages"===o[t].title?!0:!1}}}(),app.viewmodel=app.viewmodel||{},app.viewmodel={mapError:ko.observable(),places:ko.observableArray(),placeList:[],curMarker:null,curPlace:ko.observable(),inputText:ko.observable(""),frsqr:null,errorMsg:ko.observableArray([]),infoWindow:ko.observable(!1),drawerOpen:ko.observable(!1),showModal:ko.observable(!1),Place:function(e){this.show=ko.observable(!0),this.name=ko.observable(e.name),this.rating=ko.observable(e.rating),this.open=ko.observable(e.opening_hours?"Open Now":"Closed"),e.photos?this.photo=ko.observable({url:ko.observable(e.photos[0].url),height:ko.observable(e.photos[0].height),width:ko.observable(e.photos[0].width),attributions:ko.observable(e.photos[0].html_attributions)}||{}):this.photo=ko.observable("none"),this.data=e,this.detailsIcon=ko.observable("fa fa-chevron-circle-up"),this.details=ko.observable(),this.marker=app.map.createMarker(this),this.wikiInfo=ko.observable(),this.frSqrInfo=ko.observable()},WikiPage:function(e){this.content=ko.observable(e.extract),this.url=ko.observable(e.fullurl)},fourSquare:function(e,a,o){var t=ko.mapping.fromJS(e,{}),r=ko.mapping.fromJS(a,{});t.tips=r,o.frSqrInfo(t)},PlaceDetails:function(e){this.show=ko.observable(!0),this.address=ko.observable(e.formatted_address),this.phone=ko.observable(e.formatted_phone_number),this.photos=ko.observableArray(e.photos),this.rating=ko.observable(e.rating),this.website=ko.observable(e.website),this.reviews=ko.observableArray(new app.viewmodel.Reviews(e.reviews))},Reviews:function(e){var a=[];return e.forEach(function(e){a.push({author:ko.observable(e.author_name),authorUrl:ko.observable(e.author_url),text:ko.observable(e.text),time:ko.observable(e.time)})}),a},addError:function(e){this.errorMsg=this.errorMsg||ko.observableArray([]),this.errorMsg.push(e),setTimeout(function(){app.viewmodel.clearErrors()},2e3)},clearErrors:function(){this.errorMsg([])},setCurrentPlace:function(e){app.viewmodel.curPlace().marker.getAnimation()&&app.viewmodel.toggleBounce(),app.viewmodel.curPlace(e)},toggleDetails:function(e){void 0!==e.details()&&e.details().show()===!0?(e.details().show(!1),e.detailsIcon("fa fa-chevron-circle-up")):(app.map.getPlaceDetails(e),app.viewmodel.setCurrentPlace(e),e.detailsIcon("fa fa-chevron-circle-down"))},clickContactInfo:function(){this.inputText(this.curPlace().name()),app.viewmodel.placeFilter(),this.toggleDetails(app.viewmodel.curPlace()),app.map.infoWindow.close(),app.viewmodel.infoWindow(!1),this.toggleDrawer()},clickHandler:function(e){var a=e||this;app.wiki.getWiki(a),app.foursquare.findPlace(a),app.map.infoWindow.close(),app.viewmodel.drawerOpen()&&app.viewmodel.toggleDrawer(),app.viewmodel.setCurrentPlace(a),app.viewmodel.toggleBounce()},findPlaceByName:function(e){for(var a=app.viewmodel.places(),o=a.length-1;o>=0;o--)if(a[o].name()===e)return a[o];return!1},placeFilter:function(){var e=this;if(e.inputText()){var a=e.places().filter(function(a){var o=a.name().toLowerCase(),t=e.inputText().toLowerCase();return o.indexOf(t)>=0});e.places().forEach(function(e){e.marker.setMap(null),e.show(!1)}),a.forEach(function(e){e.marker.setMap(app.map.map),e.show(!0)})}else e.places().forEach(function(e){e.marker.setMap(app.map.map),e.show(!0)});return!0},resetFilter:function(){app.viewmodel.inputText(""),app.viewmodel.placeFilter();for(var e=this.places(),a=e.length-1;a>=0;a--)e[a].details()&&e[a].details().show()&&(e[a].details().show(!1),e[a].detailsIcon("fa fa-chevron-circle-up"))},setInfoWindow:function(e){var a=$("#infowindow").html();app.map.infoWindow.setContent(a),app.map.infoWindow.open(app.map.map,e.marker),app.viewmodel.infoWindow(!0)},toggleBounce:function(){if(app.viewmodel.curPlace().marker.getAnimation())app.viewmodel.curPlace().marker.setAnimation(null);else{var e=app.viewmodel.curPlace().marker;e.setAnimation(google.maps.Animation.BOUNCE)}},toggleDrawer:function(){app.viewmodel.drawerOpen(!app.viewmodel.drawerOpen())},setModal:function(){app.viewmodel.showModal(!app.viewmodel.showModal())},autocomplete:function(){var e=document.getElementById("place-input"),a=new Awesomplete(e);a.list=app.viewmodel.placeList,e.addEventListener("awesomplete-selectcomplete",function(){var e=app.viewmodel.findPlaceByName(this.value);console.log(e),app.viewmodel.setCurrentPlace(e),app.viewmodel.toggleDetails(e),app.viewmodel.inputText(this.value),app.viewmodel.placeFilter()})}};
//# sourceMappingURL=main.min.js.map
