app.map=app.map||{},function(){app.map={init:function(){var e={lat:39.927677,lng:-75.171909},a=document.getElementById("map-container");this.map=new google.maps.Map(a,{center:e,zoom:14,minZoom:12,maxZoom:18,mapTypeControl:!1}),this.placesApi=new google.maps.places.PlacesService(app.map.map),google.maps.event.addListenerOnce(this.map,"bounds_changed",this.getPlaces)},createInfoWindow:function(e){var a='<div id="test"data-bind="template: {name: \'infowindow\', data: curPlace}"></div>';if(this.infoWindow)this.infoWindow.open(app.map.map,e.marker),app.viewmodel.clickHandler(e);else{var o;this.infoWindow=new google.maps.InfoWindow({maxWidth:.7*$(window).width(),content:a}),google.maps.event.addListener(this.infoWindow,"domready",function(){o||(ko.applyBindings(app.viewmodel,$("#test")[0]),o=!0)}),google.maps.event.addListener(this.infoWindow,"closeclick",function(){app.viewmodel.infoWindow(!1)}),app.viewmodel.infoWindow(!0),app.viewmodel.clickHandler(e)}},createPlaces:function(e){e.forEach(function(e,a){var o=new app.viewmodel.Place(e);app.viewmodel.places.push(o),app.viewmodel.placeList.push(o.name()),1===a&&app.viewmodel.curPlace(o)}),app.viewmodel.autocomplete()},storePlaces:function(e){localStorage.setItem("places",JSON.stringify(e))},retrievePlaces:function(){var e=JSON.parse(localStorage.places);return e.forEach(function(e){var a=e.geometry.location.lat,o=e.geometry.location.lng;e.geometry.location.lat=function(){return a},e.geometry.location.lng=function(){return o}}),e},getPlaces:function(){if(localStorage.places&&app.map.sameBoundsCheck())console.log("Creating places from storage"),app.map.createPlaces(app.map.retrievePlaces()),ko.applyBindings(app.viewmodel,$(".container")[0]);else{localStorage.setItem("bounds",JSON.stringify(app.map.map.getBounds()));var e={bounds:app.map.map.getBounds(),types:["art_gallery","museum","park"]};app.map.placesApi.nearbySearch(e,function(e,a){if(console.log("Calling Places API"),"OK"===a)app.map.setPhotoUrls(e),app.map.storePlaces(e),app.map.createPlaces(e);else{console.log("We have a places error");var o="Google Places Error: "+a;app.viewmodel.addError(o)}ko.applyBindings(app.viewmodel,$(".container")[0])})}},sameBoundsCheck:function(){if(localStorage.bounds){var e=JSON.parse(localStorage.bounds);return app.map.map.getBounds().equals(e)}return!1},setPhotoUrls:function(e){e.forEach(function(e){if(e.photos){var a=e.photos[0].getUrl({maxWidth:200,maxHeight:300});e.photos[0].url=a}})},getPlaceDetails:function(e){var a={placeId:e.data.place_id};app.map.placesApi.getDetails(a,function(a,o){if("OK"===o){var n=new app.viewmodel.PlaceDetails(a);e.details(n)}else{var t="Google Places Error while getting details: "+o;app.viewmodel.addError(t)}})},createMarker:function(e){var a=e.data.geometry.location,o={url:e.data.icon,scaledSize:new google.maps.Size(50,50)},n=new google.maps.Marker({animation:google.maps.Animation.DROP,attribution:{source:"mrkjesus2.github.io/Neighborhood-Map"},icon:o,map:app.map.map,place:{location:{lat:a.lat(),lng:a.lng()},placeId:e.data.place_id},title:e.data.name});return google.maps.event.addListener(n,"click",function(){app.map.createInfoWindow(e)}),n}}}();
//# sourceMappingURL=main.min.js.map
