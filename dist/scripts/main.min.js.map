{"version":3,"sources":["map.js"],"names":["app","map","init","home","lat","lng","el","document","getElementById","this","google","maps","Map","center","zoom","minZoom","maxZoom","mapTypeControl","placesApi","places","PlacesService","infoWindow","InfoWindow","maxWidth","$","window","width","event","addListener","viewmodel","showDrawerBtn","setTimeout","console","log","mapError","addListenerOnce","getPlaces","createPlaces","forEach","place","idx","plc","Place","push","curPlace","storePlaces","localStorage","setItem","JSON","stringify","retrievePlaces","parse","geometry","location","sameBoundsCheck","ko","applyBindings","getBounds","request","bounds","types","nearbySearch","results","status","setPhotoUrls","msg","addError","oldBounds","equals","photos","url","getUrl","maxHeight","getPlaceDetails","placeId","data","place_id","getDetails","details","deets","PlaceDetails","createMarker","plcloc","image","icon","scaledSize","Size","marker","Marker","animation","Animation","DROP","attribution","source","title","name","clickHandler"],"mappings":"AACAA,IAAAC,IAAAD,IAAAC,QAEA,WACAD,IAAAC,KAEAC,KAAA,WACA,GAAAC,IAAAC,IAAA,UAAAC,IAAA,YACAC,EAAAC,SAAAC,eAAA,gBAEAC,MAAAR,IAAA,GAAAS,QAAAC,KAAAC,IAAAN,GACAO,OAAAV,EACAW,KAAA,GACAC,QAAA,GACAC,QAAA,GACAC,gBAAA,IAEAR,KAAAS,UAAA,GAAAR,QAAAC,KAAAQ,OAAAC,cAAApB,IAAAC,IAAAA,KACAQ,KAAAY,WAAA,GAAAX,QAAAC,KAAAW,YACAC,SAAA,GAAAC,EAAAC,QAAAC,UAIAhB,OAAAC,KAAAgB,MAAAC,YACAnB,KAAAY,WAAA,aAAArB,IAAA6B,UAAAC,eAIAC,WAAA,WACAC,QAAAC,IAAA,yBACAjC,IAAA6B,UAAAK,SAAA,mFACA,KAEAxB,OAAAC,KAAAgB,MAAAQ,gBACA1B,KAAAR,IAAA,iBAAAQ,KAAA2B,YAIAC,aAAA,SAAAlB,GACAA,EAAAmB,QAAA,SAAAC,EAAAC,GACA,GAAAC,GAAA,GAAAzC,KAAA6B,UAAAa,MAAAH,EAEAvC,KAAA6B,UAAAV,OAAAwB,KAAAF,GACA,IAAAD,GACAxC,IAAA6B,UAAAe,SAAAH,MAMAI,YAAA,SAAA1B,GACA2B,aAAAC,QAAA,SAAAC,KAAAC,UAAA9B,KAGA+B,eAAA,WACA,GAAA/B,GAAA6B,KAAAG,MAAAL,aAAA3B,OAYA,OAXAA,GAAAmB,QAAA,SAAAC,GACA,GAAAnC,GAAAmC,EAAAa,SAAAC,SAAAjD,IACAC,EAAAkC,EAAAa,SAAAC,SAAAhD,GAEAkC,GAAAa,SAAAC,SAAAjD,IAAA,WACA,MAAAA,IAEAmC,EAAAa,SAAAC,SAAAhD,IAAA,WACA,MAAAA,MAGAc,GAIAiB,UAAA,WACA,GAAAU,aAAA3B,QAAAnB,IAAAC,IAAAqD,kBACAtB,QAAAC,IAAA,gCACAjC,IAAAC,IAAAoC,aAAArC,IAAAC,IAAAiD,kBACAK,GAAAC,cAAAxD,IAAA6B,eACA,CACAiB,aAAAC,QAAA,SAAAC,KAAAC,UAAAjD,IAAAC,IAAAA,IAAAwD,aAEA,IAAAC,IACAC,OAAA3D,IAAAC,IAAAA,IAAAwD,YACAG,OAAA,cAAA,SAAA,QAIA5D,KAAAC,IAAAiB,UAAA2C,aAAAH,EAAA,SAAAI,EAAAC,GAEA,GADA/B,QAAAC,IAAA,sBACA,OAAA8B,EACA/D,IAAAC,IAAA+D,aAAAF,GACA9D,IAAAC,IAAA4C,YAAAiB,GACA9D,IAAAC,IAAAoC,aAAAyB,OACA,CACA9B,QAAAC,IAAA,yBACA,IAAAgC,GAAA,wBAAAF,CACA/D,KAAA6B,UAAAqC,SAAAD,GAEAV,GAAAC,cAAAxD,IAAA6B,eAKAyB,gBAAA,WACA,GAAAa,GAAAnB,KAAAG,MAAAL,aAAAa,OACA,OAAA3D,KAAAC,IAAAA,IAAAwD,YAAAW,OAAAD,IAGAH,aAAA,SAAA7C,GACAA,EAAAmB,QAAA,SAAAC,GACA,GAAAA,EAAA8B,OAAA,CACA,GAAAC,GAAA/B,EAAA8B,OAAA,GAAAE,QAAAhD,SAAA,IACAiD,UAAA,KACAjC,GAAA8B,OAAA,GAAAC,IAAAA,MAKAG,gBAAA,SAAAlC,GACA,GAAAmB,IACAgB,QAAAnC,EAAAoC,KAAAC,SAGA5E,KAAAC,IAAAiB,UAAA2D,WAAAnB,EAAA,SAAAoB,EAAAf,GAEA,GADA/B,QAAAC,IAAA,SAAA8B,GACA,OAAAA,EAAA,CACA,GAAAgB,GAAA,GAAA/E,KAAA6B,UAAAmD,aAAAF,EACAvC,GAAAuC,QAAAC,OACA,CACA,GAAAd,GAAA,8CAAAF,CACA/D,KAAA6B,UAAAqC,SAAAD,OAKAgB,aAAA,SAAA1C,GAEA,GAAA2C,GAAA3C,EAAAoC,KAAAvB,SAAAC,SAEA8B,GACAb,IAAA/B,EAAAoC,KAAAS,KACAC,WAAA,GAAA3E,QAAAC,KAAA2E,KAAA,GAAA,KAGAC,EAAA,GAAA7E,QAAAC,KAAA6E,QACAC,UAAA/E,OAAAC,KAAA+E,UAAAC,KACAC,aAAAC,OAAA,wCACAT,KAAAD,EACAlF,IAAAD,IAAAC,IAAAA,IACAsC,OACAc,UAAAjD,IAAA8E,EAAA9E,MAAAC,IAAA6E,EAAA7E,OACAqE,QAAAnC,EAAAoC,KAAAC,UAEAkB,MAAAvD,EAAAoC,KAAAoB,MAMA,OAHArF,QAAAC,KAAAgB,MAAAC,YAAA2D,EAAA,QAAA,WACAvF,IAAA6B,UAAAmE,aAAAzD,KAEAgD","file":"main.min.js","sourcesContent":["/* global app document google $ window ko localStorage */\napp.map = app.map || {};\n\n(function() {\n  app.map = {\n    // Callback function for Google Maps - Initialize the Map\n    init: function() {\n      var home = {lat: 39.927677, lng: -75.171909};\n      var el = document.getElementById('map-container');\n\n      this.map = new google.maps.Map(el, {\n        center: home,\n        zoom: 14,\n        minZoom: 12,\n        maxZoom: 18,\n        mapTypeControl: false\n      });\n      this.placesApi = new google.maps.places.PlacesService(app.map.map);\n      this.infoWindow = new google.maps.InfoWindow({\n        maxWidth: $(window).width() * 0.7}\n      );\n\n      // Show the drawer button when infowindow closes\n      google.maps.event.addListener(\n        this.infoWindow, 'closeclick', app.viewmodel.showDrawerBtn\n      );\n\n      // Show error message - if maps can't be reached, will be visible\n      setTimeout(function() {\n        console.log('Setting error message');\n        app.viewmodel.mapError('There appears to be a problem with Google Maps, please try refreshing the page');\n      }, 5000);\n      // Load places once the maps bounds are set\n      google.maps.event.addListenerOnce(\n        this.map, 'bounds_changed', this.getPlaces\n      );\n    },\n\n    createPlaces: function(places) {\n      places.forEach(function(place, idx) {\n        var plc = new app.viewmodel.Place(place);\n\n        app.viewmodel.places.push(plc);\n        if (idx === 1) {\n          app.viewmodel.curPlace(plc);\n        }\n      });\n    },\n\n    // Likely against TOS, but figure it's fine for educational purposes\n    storePlaces: function(places) {\n      localStorage.setItem('places', JSON.stringify(places));\n    },\n\n    retrievePlaces: function() {\n      var places = JSON.parse(localStorage.places);\n      places.forEach(function(place) {\n        var lat = place.geometry.location.lat;\n        var lng = place.geometry.location.lng;\n        // Make lat/lng into functions to match API results\n        place.geometry.location.lat = function() {\n          return lat;\n        };\n        place.geometry.location.lng = function() {\n          return lng;\n        };\n      });\n      return places;\n    },\n\n    // Get a list of places from Google Maps\n    getPlaces: function() {\n      if (localStorage.places && app.map.sameBoundsCheck()) {\n        console.log('Creating places from storage');\n        app.map.createPlaces(app.map.retrievePlaces());\n        ko.applyBindings(app.viewmodel);\n      } else {\n        localStorage.setItem('bounds', JSON.stringify(app.map.map.getBounds()));\n        // Variables for the request\n        var request = {\n          bounds: app.map.map.getBounds(),\n          types: ['art_gallery', 'museum', 'park']\n        };\n\n        // Call the Places API\n        app.map.placesApi.nearbySearch(request, function(results, status) {\n          console.log('Calling Places API');\n          if (status === 'OK') {\n            app.map.setPhotoUrls(results);\n            app.map.storePlaces(results);\n            app.map.createPlaces(results);\n          } else {\n            console.log('We have a places error');\n            var msg = 'Google Places Error: ' + status;\n            app.viewmodel.addError(msg);\n          }\n          ko.applyBindings(app.viewmodel);\n        });\n      }\n    },\n\n    sameBoundsCheck: function() {\n        var oldBounds = JSON.parse(localStorage.bounds);\n        return app.map.map.getBounds().equals(oldBounds);\n    },\n\n    setPhotoUrls: function(places) {\n      places.forEach(function(place) {\n        if (place.photos) {\n          var url = place.photos[0].getUrl({maxWidth: 200,\n                                            maxHeight: 300});\n          place.photos[0].url = url;\n        }\n      });\n    },\n\n    getPlaceDetails: function(place) {\n      var request = {\n        placeId: place.data.place_id\n      };\n      // Call the Places API, add details to the place\n      app.map.placesApi.getDetails(request, function(details, status) {\n        console.log('status', status);\n        if (status === 'OK') {\n          var deets = new app.viewmodel.PlaceDetails(details);\n          place.details(deets);\n        } else {\n          var msg = 'Google Places Error while getting details: ' + status;\n          app.viewmodel.addError(msg);\n        }\n      });\n    },\n\n    createMarker: function(place) {\n      // Location for the Marker\n      var plcloc = place.data.geometry.location;\n      // Set icon and icon size\n      var image = {\n        url: place.data.icon,\n        scaledSize: new google.maps.Size(50, 50)\n      };\n      // Create the marker\n      var marker = new google.maps.Marker({\n        animation: google.maps.Animation.DROP,\n        attribution: {source: 'mrkjesus2.github.io/Neighborhood-Map'},\n        icon: image,\n        map: app.map.map,\n        place: {\n          location: {lat: plcloc.lat(), lng: plcloc.lng()},\n          placeId: place.data.place_id\n        },\n        title: place.data.name\n      });\n\n      google.maps.event.addListener(marker, 'click', function() {\n        app.viewmodel.clickHandler(place);\n      });\n      return marker;\n    }\n  };\n})();\n"],"sourceRoot":"/source/"}