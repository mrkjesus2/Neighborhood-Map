{"version":3,"sources":["viewModel.js"],"names":["app","viewmodel","places","ko","observableArray","curMarker","curPlace","observable","inputText","frsqr","errorMsg","Place","place","this","show","name","rating","open","opening_hours","photos","photo","url","height","width","attributions","html_attributions","data","detailsIcon","details","marker","map","createMarker","wikiInfo","frSqrInfo","WikiPage","page","content","extract","fullurl","fourSquare","info","tips","mapping","fromJS","frSqrTips","PlaceDetails","address","formatted_address","phone","formatted_phone_number","website","reviews","Reviews","arr","forEach","review","push","author","author_name","authorUrl","author_url","text","time","addError","msg","setTimeout","clearErrors","setCurrentPlace","getAnimation","toggleBounce","toggleDetails","undefined","getPlaceDetails","clickContactInfo","$","trigger","infoWindow","close","closeDrawer","toggleDrawer","clickHandler","plc","wiki","getWiki","foursquare","findPlace","setInfoWindow","removeClass","addClass","placeFilter","self","matches","filter","toLowerCase","input","indexOf","setMap","resetFilter","html","setContent","setAnimation","google","maps","Animation","BOUNCE","els","document","getElementsByClassName","toggleClass","el","hasClass","showDrawerBtn","openModal","css","console","log","closeModal","init","button","getElementById","addEventListener"],"mappings":"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","file":"main.min.js","sourcesContent":["/* global app ko $ google document */\n\napp.viewmodel = app.viewmodel || {};\n\napp.viewmodel = {\n  places: ko.observableArray(),\n  curMarker: null,\n  curPlace: ko.observable(),\n  inputText: ko.observable(''),\n  frsqr: null,\n  errorMsg: ko.observableArray([]),\n\n/* ************* */\n/* Constructors */\n/* ************ */\n  Place: function(place) {\n    this.show = ko.observable(true);\n\n    // Info returned from map.getPlaces\n    this.name = ko.observable(place.name);\n    this.rating = ko.observable(place.rating);\n    this.open = ko.observable(\n      place.opening_hours ? 'Open Now' : 'Closed' || 'Hours not available'\n    );\n    if (place.photos) {\n      this.photo = ko.observable({\n        url: ko.observable(place.photos[0].url),\n        height: ko.observable(place.photos[0].height),\n        width: ko.observable(place.photos[0].width),\n        attributions: ko.observable(place.photos[0].html_attributions)\n      } || {});\n    } else {\n      this.photo = ko.observable('none');\n    }\n    this.data = place;\n    this.detailsIcon = ko.observable('fa fa-chevron-circle-up');\n\n    // Info from elsewhere\n    this.details = ko.observable();\n    this.marker = app.map.createMarker(this);\n    this.wikiInfo = ko.observable();\n    this.frSqrInfo = ko.observable();\n  },\n\n  WikiPage: function(page) {\n    this.content = ko.observable(page.extract);\n    this.url = ko.observable(page.fullurl);\n  },\n\n  fourSquare: function(info, tips, place) {\n    // Map FourSquare responses to observables\n    var frSqrInfo = ko.mapping.fromJS(info, {});\n    var frSqrTips = ko.mapping.fromJS(tips, {});\n    // Create a child object for tips response\n    frSqrInfo.tips = frSqrTips;\n    // Assign the info to the place\n    place.frSqrInfo(frSqrInfo);\n  },\n\n  PlaceDetails: function(details) {\n    this.show = ko.observable(true);\n    this.address = ko.observable(details.formatted_address);\n    this.phone = ko.observable(details.formatted_phone_number);\n    this.photos = ko.observableArray(details.photos);\n    this.rating = ko.observable(details.rating);\n    this.website = ko.observable(details.website);\n    this.reviews = ko.observableArray(new app.viewmodel.Reviews(details.reviews));\n  },\n\n  Reviews: function(reviews) {\n    var arr = [];\n    reviews.forEach(function(review) {\n      arr.push({\n        author: ko.observable(review.author_name),\n        authorUrl: ko.observable(review.author_url),\n        text: ko.observable(review.text),\n        time: ko.observable(review.time)\n      });\n    });\n    return arr;\n  },\n\n/* **************** */\n/* Helper Functions */\n/* **************** */\n  addError: function(msg) {\n    this.errorMsg = this.errorMsg || ko.observableArray([]);\n    this.errorMsg.push(msg);\n    setTimeout(function() {\n      app.viewmodel.clearErrors();\n    }, 2000);\n  },\n\n  clearErrors: function() {\n    this.errorMsg([]);\n  },\n\n  setCurrentPlace: function(place) {\n    if (app.viewmodel.curPlace().marker.getAnimation()) {\n      app.viewmodel.toggleBounce();\n    }\n    app.viewmodel.curPlace(place);\n  },\n\n  toggleDetails: function(place) {\n    if (place.details() !== undefined && place.details().show() === true) {\n      place.details().show(false);\n      place.detailsIcon('fa fa-chevron-circle-up');\n    } else {\n      app.map.getPlaceDetails(place);\n      app.viewmodel.setCurrentPlace(place);\n      place.detailsIcon('fa fa-chevron-circle-down');\n    }\n  },\n\n  clickContactInfo: function() {\n    this.inputText(this.curPlace().name());\n    $('#drawer-top input').trigger('input');\n    this.toggleDetails(app.viewmodel.curPlace());\n    app.map.infoWindow.close();\n    this.closeDrawer();\n    this.toggleDrawer();\n  },\n\n  // Called when the marker or list item is clicked\n  clickHandler: function(place) {\n    var plc = place || this;\n\n    // Call for data\n    app.wiki.getWiki(plc);\n    app.foursquare.findPlace(plc);\n    // app.map.getPlaceDetails(plc);\n\n    // Handle map actions\n    app.map.infoWindow.close();\n    app.viewmodel.closeDrawer();\n    app.viewmodel.setCurrentPlace(plc);\n    app.viewmodel.toggleBounce();\n    // app.viewmodel.markerSetup(plc);\n\n    // Timeout to avoid two calls from success callbacks\n    setTimeout(function() {\n      app.viewmodel.setInfoWindow(plc);\n      // Hide the drawer button while infowindow is open\n      $('#drawer-btn').removeClass('closed');\n      $('#drawer-btn').addClass('open');\n    }, 300);\n  },\n\n  placeFilter: function() {\n    var self = this;\n    // A cushion to allow inputText to change\n    setTimeout(function() {\n      // Get the matching places\n      if (self.inputText()) {\n        var matches = self.places().filter(function(place) {\n          var name = place.name().toLowerCase();\n          var input = self.inputText().toLowerCase();\n          return name.indexOf(input) === 0;\n        });\n\n        // Set markers and list items to hidden\n        self.places().forEach(function(place) {\n          place.marker.setMap(null);\n          place.show(false);\n        });\n\n        // Add remaining places to the map and list\n        matches.forEach(function(place) {\n          place.marker.setMap(app.map.map);\n          place.show(true);\n        });\n      } else {\n        // Set all place markers on the map\n        self.places().forEach(function(place) {\n          place.marker.setMap(app.map.map);\n          place.show(true);\n        });\n      }\n    }, 100);\n\n    // Must return true to allow default behavior (Filling the input box)\n    return true;\n  },\n\n  resetFilter: function() {\n    app.viewmodel.inputText('');\n    $('#drawer-top input').trigger('input');\n  },\n\n  setInfoWindow: function(place) {\n    var content = $('#infowindow').html();\n\n    app.map.infoWindow.setContent(content);\n    app.map.infoWindow.open(app.map.map, place.marker);\n  },\n\n  // Strictly view related (create a separate file if there is more)\n  toggleBounce: function() {\n    if (app.viewmodel.curPlace().marker.getAnimation()) {\n      app.viewmodel.curPlace().marker.setAnimation(null);\n    } else {\n      var marker = app.viewmodel.curPlace().marker;\n      marker.setAnimation(google.maps.Animation.BOUNCE);\n    }\n  },\n\n  toggleDrawer: function() {\n    var els = document.getElementsByClassName('drawer');\n    $(els).toggleClass('closed open');\n  },\n\n  closeDrawer: function() {\n    // Reset drawer button if infowindow is open\n    var el = $('#drawer-btn');\n    if (el.hasClass('open')) {\n      el.removeClass('open');\n      el.addClass('closed');\n    }\n    // Close the drawer if it is open\n    if ($('#drawer-content').hasClass('open')) {\n      app.viewmodel.toggleDrawer();\n    }\n  },\n\n  showDrawerBtn: function() {\n    $('#drawer-btn').removeClass('open');\n    $('#drawer-btn').addClass('closed');\n  },\n\n  openModal: function() {\n    $('#modal').css('display', 'initial');\n    console.log('Open Modal');\n  },\n\n  closeModal: function() {\n    $('#modal').css('display', 'none');\n  },\n\n  init: function() {\n    var button = document.getElementById('drawer-btn');\n    button.addEventListener('click', app.viewmodel.toggleDrawer);\n  }\n};\n\napp.viewmodel.init();\n"],"sourceRoot":"/source/"}