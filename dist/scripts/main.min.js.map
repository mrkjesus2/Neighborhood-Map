{"version":3,"sources":["map.js"],"names":["app","map","init","console","log","home","lat","lng","el","document","getElementById","this","google","maps","Map","center","zoom","minZoom","maxZoom","mapTypeControl","placesApi","places","PlacesService","setTimeout","viewmodel","mapError","event","addListenerOnce","getPlaces","createInfoWindow","place","content","infoWindow","open","marker","clickHandler","infoWindowLoaded","InfoWindow","maxWidth","$","window","width","addListener","ko","applyBindings","createPlaces","forEach","idx","plc","Place","push","placeList","name","curPlace","autocomplete","storePlaces","localStorage","setItem","JSON","stringify","retrievePlaces","parse","geometry","location","sameBoundsCheck","getBounds","request","bounds","types","nearbySearch","results","status","setPhotoUrls","msg","addError","oldBounds","equals","photos","url","getUrl","maxHeight","getPlaceDetails","placeId","data","place_id","getDetails","details","deets","PlaceDetails","createMarker","plcloc","image","icon","scaledSize","Size","Marker","animation","Animation","DROP","attribution","source","title"],"mappings":"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","file":"main.min.js","sourcesContent":["/* global app document google $ window ko localStorage */\napp.map = app.map || {};\n\n(function() {\n  app.map = {\n    // Callback function for Google Maps - Initialize the Map\n    init: function() {\n      console.log('map.init'); // REMOVE\n      var home = {lat: 39.927677, lng: -75.171909};\n      var el = document.getElementById('map-container');\n\n      this.map = new google.maps.Map(el, {\n        center: home,\n        zoom: 14,\n        minZoom: 12,\n        maxZoom: 18,\n        mapTypeControl: false\n      });\n      this.placesApi = new google.maps.places.PlacesService(app.map.map);\n\n      // TODO: Fix error handling\n      // Show error message - if maps can't be reached, will be visible\n      setTimeout(function() {\n        app.viewmodel.mapError('There appears to be a problem with Google Maps, please try refreshing the page');\n      }, 5000);\n      // Load places once the maps bounds are set\n      google.maps.event.addListenerOnce(\n        this.map, 'bounds_changed', this.getPlaces\n      );\n    },\n\n    // with a little help from 'http://jsfiddle.net/G6MXd/4/'\n    createInfoWindow: function(place) {\n      console.log('createInfoWindow'); // REMOVE\n      var content =\n        '<div id=\"test\"\\\n          data-bind=\"template: {name: \\'infowindow\\', data: curPlace}\">\\\n        </div>';\n\n      if (!this.infoWindow) {\n        console.log('Initializing infoWindow'); // REMOVE\n\n        var infoWindowLoaded;\n\n        this.infoWindow = new google.maps.InfoWindow({\n          maxWidth: $(window).width() * 0.7,\n          content: content\n        });\n\n        // Apply bindings once the window is attached to DOM\n        google.maps.event.addListener(this.infoWindow, 'domready', function() {\n          if (!infoWindowLoaded) {\n            ko.applyBindings(app.viewmodel, $('#test')[0]);\n            infoWindowLoaded = true;\n          }\n        });\n\n        // Show the drawer button when infowindow closes\n        google.maps.event.addListener(this.infoWindow, 'closeclick', function() {\n          app.viewmodel.infoWindow(false);\n        });\n\n        // Hide the drawer button while window is open\n        app.viewmodel.infoWindow(true);\n\n        app.viewmodel.clickHandler(place);\n  // TODO: REALLY HAS TO BE DONE Likely need a listener on 'content_changed' or 'position_changed' that adjusts the window(centers infowindow)\n        // Handle when the infoWindow exists\n      } else {\n        console.log('Info Window Else Statement'); // REMOVE\n        this.infoWindow.open(app.map.map, place.marker);\n        app.viewmodel.clickHandler(place);\n      }\n    },\n\n    createPlaces: function(places) {\n      console.log('createPlaces'); // REMOVE\n      places.forEach(function(place, idx) {\n        var plc = new app.viewmodel.Place(place);\n\n        app.viewmodel.places.push(plc);\n        app.viewmodel.placeList.push(plc.name());\n        if (idx === 1) {\n          app.viewmodel.curPlace(plc);\n        }\n      });\n      app.viewmodel.autocomplete();\n    },\n\n    // Likely against TOS, but figure it's fine for educational purposes\n    storePlaces: function(places) {\n      console.log('storePlaces'); // REMOVE\n      localStorage.setItem('places', JSON.stringify(places));\n    },\n\n    retrievePlaces: function() {\n      console.log('retrievePlaces'); // REMOVE\n      var places = JSON.parse(localStorage.places);\n      places.forEach(function(place) {\n        var lat = place.geometry.location.lat;\n        var lng = place.geometry.location.lng;\n        // Make lat/lng into functions to match API results\n        place.geometry.location.lat = function() {\n          return lat;\n        };\n        place.geometry.location.lng = function() {\n          return lng;\n        };\n      });\n      return places;\n    },\n\n    // Get a list of places from Google Maps\n    getPlaces: function() {\n      console.log('getPlaces'); // REMOVE\n      if (localStorage.places && app.map.sameBoundsCheck()) {\n        console.log('Creating places from storage');\n        app.map.createPlaces(app.map.retrievePlaces());\n        ko.applyBindings(app.viewmodel, $('.container')[0]);\n      } else {\n        localStorage.setItem('bounds', JSON.stringify(app.map.map.getBounds()));\n        // Variables for the request\n        var request = {\n          bounds: app.map.map.getBounds(),\n          types: ['art_gallery', 'museum', 'park']\n        };\n\n        // Call the Places API\n        app.map.placesApi.nearbySearch(request, function(results, status) {\n          console.log('Calling Places API');\n          if (status === 'OK') {\n            app.map.setPhotoUrls(results);\n            app.map.storePlaces(results);\n            app.map.createPlaces(results);\n          } else {\n            console.log('We have a places error');\n            var msg = 'Google Places Error: ' + status;\n            app.viewmodel.addError(msg);\n          }\n          ko.applyBindings(app.viewmodel, $('.container')[0]);\n        });\n      }\n    },\n\n    sameBoundsCheck: function() {\n      console.log('sameBoundsCheck'); // REMOVE\n      if (localStorage.bounds) {\n        var oldBounds = JSON.parse(localStorage.bounds);\n        return app.map.map.getBounds().equals(oldBounds);\n      }\n      return false;\n    },\n\n    setPhotoUrls: function(places) {\n      console.log('setPhotoUrls'); // REMOVE\n      places.forEach(function(place) {\n        if (place.photos) {\n          var url = place.photos[0].getUrl({maxWidth: 200,\n                                            maxHeight: 300});\n          place.photos[0].url = url;\n        }\n      });\n    },\n\n    getPlaceDetails: function(place) {\n      console.log('getPlaceDetails'); // REMOVE\n      var request = {\n        placeId: place.data.place_id\n      };\n      // Call the Places API, add details to the place\n      app.map.placesApi.getDetails(request, function(details, status) {\n        if (status === 'OK') {\n          var deets = new app.viewmodel.PlaceDetails(details);\n          place.details(deets);\n        } else {\n          var msg = 'Google Places Error while getting details: ' + status;\n          app.viewmodel.addError(msg);\n        }\n      });\n    },\n\n    createMarker: function(place) {\n      console.log('createMarker'); // REMOVE\n      // Location for the Marker\n      var plcloc = place.data.geometry.location;\n      // Set icon and icon size\n      var image = {\n        url: place.data.icon,\n        scaledSize: new google.maps.Size(50, 50)\n      };\n      // Create the marker\n      var marker = new google.maps.Marker({\n        animation: google.maps.Animation.DROP,\n        attribution: {source: 'mrkjesus2.github.io/Neighborhood-Map'},\n        icon: image,\n        map: app.map.map,\n        place: {\n          location: {lat: plcloc.lat(), lng: plcloc.lng()},\n          placeId: place.data.place_id\n        },\n        title: place.data.name\n      });\n\n      google.maps.event.addListener(marker, 'click', function() {\n        // app.viewmodel.clickHandler(place);\n        app.map.createInfoWindow(place); // test\n      });\n      return marker;\n    }\n  };\n})();\n"],"sourceRoot":"/source/"}